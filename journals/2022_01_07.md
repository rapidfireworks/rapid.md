- # Page
- [[Wiki]]
- [[Bucket List]]
- [[Percent Encoding]]
- [[minikube]]
- [[kubectl]]
- # Memo
- [[Firefox]]에서 주소를 복사하면 [[Percent Encoding]]이 적용되는데, 끝에 공백을 붙여 복사하면 이를 막을 수 있다.
- [[minikube]]의 드라이버로 [[Docker]]를 사용 중이라면 `minikube service ${SERVICE_NAME}` 명령어를 이용해 접속할 수 있다.
- # Kubernetes
- [[Google]]이 만든, [[Container]]를 쉽고 빠르게 배포, 확장하고 관리를 자동화해주는 오픈소스 플랫폼
- 리소스 관리 시 name과 label을 이용한다.
- # K8s Pod
- Pod is a collection of containers that can run on a host. This resource is created by clients and scheduled onto hosts.
- [[Kubernetes]]에서 관리하는 가장 작은 배포 단위
- 한 개 또는 여러 개의 [[Container]]를 포함할 수 있다.
- ## 생성 과정
- `kubectl run`
- Scheduler는 API서버를 감시하면서 할당되지 않은unassigned Pod이 있는지 체크
- Scheduler는 할당되지 않은 Pod을 감지하고 적절한 노드node에 할당 (minikube는 단일 노드)
- 노드에 설치된 kubelet은 자신의 노드에 할당된 Pod이 있는지 체크
- kubelet은 Scheduler에 의해 자신에게 할당된 Pod의 정보를 확인하고 컨테이너 생성
- kubelet은 자신에게 할당된 Pod의 상태를 API 서버에 전달
- ## ${POD_NAME}.yml
- 필수 요소
	- apiVersion
	- kind
	- metadata
	- spec
- ## Monitoring Container
- [[Container]] 생성 이후 서비스가 준비되는 데에 시간이 소요되므로, 이를 체크하는 옵션이 필요하다.
- livenessProbe
	- 컨테이너가 정상적으로 동작하는 지 체크하고 정상적으로 동작하지 않는다면 컨테이너를 재시작한다.
- readynessProbe
	- 컨테이너가 준비 되었는지 체크하고 정상적으로 준비되지 않았다면 Pod으로 들어오는 요청을 제외한다.
- # K8s ReplicaSet
- 명시된 [[K8s Pod]] 개수에 대한 가용성을 보증하는데 사용한다.
- label을 이용하여 [[K8s Pod]]을 체크하기 때문에 label이 겹치지 않게 주의해야 한다.
- ## 동작 과정
- ReplicaSet Controller는 ReplicaSet조건을 감시하면서 현재 상태와 원하는 상태가 다른 것을 체크
- ReplicaSet Controller가 원하는 상태가 되도록 Pod을 생성하거나 제거
- Scheduler는 API서버를 감시하면서 할당되지 않은unassigned Pod이 있는지 체크
- Scheduler는 할당되지 않은 새로운 Pod을 감지하고 적절한 노드node에 배치
- 이후 노드는 기존대로 동작
- # K8s Deployment
- [[K8s ReplicaSet]]을 이용하여 [[K8s Pod]]을 업데이트하고 이력을 관리하여 롤백하거나 특정 버전으로 돌아간다.
- 새로운 버전의 [[K8s Pod]]을 생성하고 기존 [[K8s Pod]]을 제거하는 방식으로 업데이트한다.
- 변경된 상태를 기록하고, `kubectl rollout history deploy/${DEPLOYMENT_NAME}` 명령어를 이용해 확인할 수 있다.
- ## 동작 과정
- Deployment Controller는 Deployment조건을 감시하면서 현재 상태와 원하는 상태가 다른 것을 체크
- Deployment Controller가 원하는 상태가 되도록 ReplicaSet 설정
- ReplicaSet Controller는 ReplicaSet조건을 감시하면서 현재 상태와 원하는 상태가 다른 것을 체크
- ReplicaSet Controller가 원하는 상태가 되도록 Pod을 생성하거나 제거
- Scheduler는 API서버를 감시하면서 할당되지 않은unassigned Pod이 있는지 체크
- Scheduler는 할당되지 않은 새로운 Pod을 감지하고 적절한 노드node에 배치
- 이후 노드는 기존대로 동작
- ## Strategy
- Recreate
- Rolling Update
	- maxSurge
	- maxUnavailable
- # K8s Service
- [[K8s Pod]]과 직접 통신하는 방법 대신, 별도의 고정된 IP를 가진 서비스를 만들고 그 서비스를 통해 [[K8s Pod]]에 접근한다.